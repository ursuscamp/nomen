{% extends "base.html" %}

{% block body %}
<main>
  <h1>{% if upgrade %}Upgrade{% else %}New{% endif %} Name</h1>

  {% if !psbt.is_empty() %}
  <p>Sign and broadcast this transaction with your Bitcoin wallet:</p>
  <pre id="psbt">{{ psbt }}</pre>
  <button id="copy">Copy</button>

  <p>After signing and transmitting the transaction, <a href="/updaterecords?name={{ name }}&pubkey={{ pubkey }}">setup
      your records</a> for the indexer to property index your new name.</p>

  <script>
    let btn = document.getElementById('copy');
    btn.addEventListener('click', async (event) => {
      event.preventDefault();
      let tx = document.getElementById('psbt').innerHTML;
      await navigator.clipboard.writeText(tx);
      btn.innerHTML = 'Copied'
      setTimeout(() => {
        btn.innerHTML = 'Copy'
      }, 1000);
    });
  </script>

  {% else %}

  {% if upgrade %}
  <p>
    You can upgrade an old-style v0 name to v1 by simply recreating it. As long as the name and pubkey match, the
    protocol will treat it as an upgrade.
  </p>
  {% else %}
  <p>
    You can generate a Bitcoin transaction that will reserve a name for you. Simply enter a transaction id and output
    number for a UTXO that you control.
    Also enter your fee rate that you wish to spend to the miners, the name you are reserving and the pubkey that will
    be the owner of the name.
  </p>
  {% endif %}

  <p>
    After submitting the form, you will be given a PSBT (partially-signed Bitcoin transaction) which you can sign with
    your Bitcoin wallet and broadcast. Once it is
    mined and has {{ confirmations }} confirmations, it will be indexed.
  </p>

  <p>
    In order for the indexer to properly index your name, you also need to send your records after you broadcast your
    transaction!
    You can comeback anytime and click on <a href="/updaterecords">Update Records</a> in the navigation menu.
  </p>

  <form action="/newname" method="POST">
    <input type="hidden" name="upgrade" value="{{ upgrade }}">
    <h2>Input Tx</h2>
    <p>
      <label for="txid">Txid</label>
      <input type="text" name="txid" id="txid" value="{{ txid }}">
    </p>

    <p>
      <label for="vout">Vout</label>
      <input type="text" name="vout" id="vout" value="{{ vout }}">
    </p>

    <h2>Output</h2>

    <p>
      <label for="address">Change Address</label>
      <input type="text" id="address" name="address" value="{{ address }}">
    </p>

    <p>
      <label for="fee">Fee (sats/vb)</label>
      <input type="text" id="fee" name="fee" value="{{ fee }}">
    </p>

    <p>
      <label for="name">Name</label>
      <input type="text" id="name" name="name" value="{{ name }}">
    </p>

    {% include "pubkey.html" %}

    <p>
      <input type="submit" value="Submit">
    </p>
  </form>



  {% endif %}
</main>

{% endblock %}